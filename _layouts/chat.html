<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

{%- include head.html -%}

<body class="chat-layout">

  <!-- í…”ë ˆê·¸ë¨ ìŠ¤íƒ€ì¼ í”„ë¡œí•„ ëª¨ë‹¬ -->
  <div id="profileModal" class="tg-modal">
    <div class="tg-modal-overlay"></div>
    <div class="tg-profile-card">
      <div class="tg-profile-header">
        <div class="tg-avatar">
          <img src="/images/face2.jpeg?t={{ site.time | date: "%s" }}" alt="Profile" class="tg-avatar-img">
          <div class="tg-online-status"></div>
        </div>
        <h3 class="tg-profile-name">ê°•ì„±ìš±</h3>
        <p class="tg-profile-status">ë°±ì—”ë“œ ê°œë°œì</p>
        <p class="tg-last-seen">ì˜¨ë¼ì¸</p>
      </div>

      <div class="tg-profile-info">
        <div class="tg-info-item">
          <div class="tg-info-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="tg-info-content">
            <div class="tg-info-label">ê²½ë ¥</div>
            <div class="tg-info-value">3ë…„ì°¨</div>
          </div>
        </div>

        <div class="tg-info-item">
          <div class="tg-info-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <polyline points="16,18 22,12 16,6" stroke="currentColor" stroke-width="2"/>
              <polyline points="8,6 2,12 8,18" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="tg-info-content">
            <div class="tg-info-label">ì „ë¬¸ë¶„ì•¼</div>
            <div class="tg-info-value">ë°±ì—”ë“œ, DevOps, ë¯¸ë””ì–´</div>
          </div>
        </div>
      </div>

      <div class="tg-contact-actions">
        <a href="mailto:ksqrt.work@gmail.com" class="tg-action-btn tg-email-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2"/>
            <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span>ì´ë©”ì¼</span>
        </a>

        <a href="https://github.com/kminmax" target="_blank" class="tg-action-btn tg-github-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span>GitHub</span>
        </a>
      </div>

      <button id="closeProfile" class="tg-close-btn">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ -->
  <div id="imageModal" class="image-modal">
    <div class="modal-content">
      <img id="modalImage" class="modal-image" src="" alt="">
      <button id="modalClose" class="modal-close">Ã—</button>
      <button id="modalPrev" class="modal-nav prev">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,18 9,12 15,6"></polyline>
        </svg>
      </button>
      <button id="modalNext" class="modal-nav next">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </button>
    </div>
  </div>

  <div class="main-wrapper">
    <!-- PCìš© ì‚¬ì´ë“œë°” -->
    <div class="sidebar" id="sidebar">
      <nav class="sidebar-nav">
        <a href="#intro" class="nav-item active" data-section="intro">
          <span class="nav-icon">ğŸ˜Š</span>
          <span class="nav-text">ìê¸°ì†Œê°œ</span>
        </a>
        <a href="#skills-backend" class="nav-item" data-section="skills-backend">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-text">ê¸°ìˆ  ìŠ¤íƒ</span>
        </a>
        <a href="#experience" class="nav-item" data-section="experience">
          <span class="nav-icon">ğŸ’¼</span>
          <span class="nav-text">ê²½ë ¥</span>
        </a>
        <a href="#projects" class="nav-item" data-section="projects">
          <span class="nav-icon">ğŸš€</span>
          <span class="nav-text">í”„ë¡œì íŠ¸</span>
        </a>
        <a href="#certifications" class="nav-item" data-section="certifications">
          <span class="nav-icon">ğŸ†</span>
          <span class="nav-text">ìê²©ì¦</span>
        </a>
      </nav>
    </div>

    <div class="chat-container">
      <div class="chat-header">
        <div class="header-content">
          <div class="header-left">
            <div class="header-title">
              <h1 id="headerTitle">{{ page.title | default: "Developer Portfolio" }}</h1>
              <div class="breadcrumb" id="breadcrumb" style="display: none;">
                <span class="breadcrumb-current" id="currentSection">ìê¸°ì†Œê°œ</span>
              </div>
            </div>
          </div>
          <div class="header-right">
            <div class="mode-toggle">
              <div class="toggle-container">
                <span class="toggle-label left-label">ëŒ€í™”í˜•</span>
                <button id="modeToggle" class="toggle-switch chat-mode-active" title="PDF í˜•íƒœë¡œ ì „í™˜">
                  <div class="toggle-track">
                    <div class="toggle-thumb">
                      <span class="toggle-icon chat-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <span class="toggle-icon pdf-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                    </div>
                  </div>
                </button>
                <span class="toggle-label right-label">PDF</span>
              </div>
            </div>
            <div class="pdf-download">
              <button id="pdfDownload" class="download-btn" title="PDF ë‹¤ìš´ë¡œë“œ">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7,10 12,15 17,10"/>
                  <line x1="12" x2="12" y1="15" y2="3"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-messages" id="chatMessages">
        {{ content }}
      </div>

      <!-- ëª¨ë°”ì¼/íƒœë¸”ë¦¿ìš© ê°€ë¡œ ìŠ¬ë¼ì´ë”© ë„¤ë¹„ê²Œì´ì…˜ -->
      <div id="mobileNav" class="mobile-nav">
        <div class="mobile-nav-container">
          <a href="#intro" class="mobile-nav-item active" data-section="intro">
            <span class="mobile-nav-text">ìê¸°ì†Œê°œ</span>
          </a>
          <a href="#skills-backend" class="mobile-nav-item" data-section="skills-backend">
            <span class="mobile-nav-text">ê¸°ìˆ  ìŠ¤íƒ</span>
          </a>
          <a href="#experience" class="mobile-nav-item" data-section="experience">
            <span class="mobile-nav-text">ê²½ë ¥</span>
          </a>
          <a href="#projects" class="mobile-nav-item" data-section="projects">
            <span class="mobile-nav-text">í”„ë¡œì íŠ¸</span>
          </a>
          <a href="#certifications" class="mobile-nav-item" data-section="certifications">
            <span class="mobile-nav-text">ìê²©ì¦</span>
          </a>
        </div>
      </div>

      <!-- ì…ë ¥ì°½ -->
      <div class="chat-input-container">
        <div class="chat-input-wrapper">
          <input type="text" id="chatInput" class="chat-input" placeholder="" readonly>
          <button id="sendButton" class="send-button">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ê°€ì§œ ì»¤ì„œ -->
  <div id="fakeCursor" class="fake-cursor"></div>
    </div>
  </div>

  <script>
    // ë¯¸ë¦¬ ì •ì˜ëœ ì§ˆë¬¸ë“¤
    const questions = [
      "ì•ˆë…•í•˜ì„¸ìš”! ìê¸°ì†Œê°œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
      "ê¸°ìˆ  ìŠ¤íƒì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”.",
      "ì–´ë–¤ ê²½ë ¥ì´ ìˆìœ¼ì‹ ê°€ìš”?",
      "ì–´ë–¤ í”„ë¡œì íŠ¸ë“¤ì„ ì§„í–‰í•´ë³´ì…¨ë‚˜ìš”?",
      "ì–´ë–¤ ìê²©ì¦ì„ ë³´ìœ í•˜ê³  ê³„ì‹ ê°€ìš”?"
    ];

    // ì„¹ì…˜ ì´ë¦„ ë§¤í•‘
    const sectionNames = {
      'intro': 'ìê¸°ì†Œê°œ',
      'skills-backend': 'ê¸°ìˆ  ìŠ¤íƒ',
      'experience': 'ê²½ë ¥',
      'projects': 'í”„ë¡œì íŠ¸',
      'certifications': 'ìê²©ì¦'
    };

    let currentSectionIndex = 0;
    let isTyping = false;
    let lastMouseX = window.innerWidth / 2;
    let lastMouseY = window.innerHeight / 2;
    let isFirstAnimation = true;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      initializeChat();
      initializePdfDownload();
    });

    function initializeChat() {
      // ëª¨ë“  ë‹µë³€ ë©”ì‹œì§€ì— ì•„ë°”íƒ€ ì»¨í…Œì´ë„ˆ ì¶”ê°€
      document.querySelectorAll('.answer').forEach((answer) => {
        if (!answer.querySelector('.avatar-container')) {
          const section = answer.closest('.chat-section');
          const isFirstInSection = section.querySelector('.answer') === answer;

          const avatarContainer = document.createElement('div');
          avatarContainer.className = 'avatar-container';

          if (isFirstInSection) {
            const avatar = document.createElement('div');
            avatar.className = 'avatar profile-avatar clickable-avatar';
            avatar.addEventListener('click', function() {
              document.getElementById('profileModal').style.display = 'block';
            });
            avatarContainer.appendChild(avatar);
          }

          answer.insertBefore(avatarContainer, answer.querySelector('.message'));
        }
      });

      // ì§ˆë¬¸ ë©”ì‹œì§€ì— ì•„ë°”íƒ€ ì¶”ê°€
      updateQuestionAvatars();

      // ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ì´ˆê¸°í™”
      initializeSidebarNavigation();

      // í”„ë¡œí•„ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      initializeProfileModal();

      // ì±„íŒ… ì…ë ¥ ì´ˆê¸°í™”
      initializeChatInput();

      // ëª¨ë“œ í† ê¸€ ì´ˆê¸°í™”
      initializeModeToggle();

      // í•­ìƒ ëŒ€í™”í˜• ëª¨ë“œë¡œ ì„¤ì •
      document.body.classList.add('chat-mode');

      // ì´ˆê¸° ìƒíƒœ ì„¤ì •: ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
      hideAllSections();

      // OS ê°ì§€ ë° ê°€ì§œ ì»¤ì„œ ì„¤ì •
      setupFakeCursor();

      // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ì¶”ì 
      trackMousePosition();

      // ì‹œì‘ ì‹œìŠ¤í…œ ë©”ì‹œì§€ í‘œì‹œ
      setTimeout(() => {
        showStartMessage();
      }, 100);

      // ì²« ë²ˆì§¸ ì§ˆë¬¸ ìë™ ì‹œì‘ (ì‹œìŠ¤í…œ ë©”ì‹œì§€ í›„)
      setTimeout(() => {
        startFirstConversation();
      }, 375);
    }

    function hideAllSections() {
      const sections = document.querySelectorAll('.chat-section');
      sections.forEach(section => {
        section.style.display = 'none';
      });
    }



    function setupFakeCursor() {
      const fakeCursor = document.getElementById('fakeCursor');

      // ê¸°ë³¸ ì»¤ì„œë¡œ ì‹œì‘
      fakeCursor.classList.add('normal');
    }

    function trackMousePosition() {
      // ë§ˆìš°ìŠ¤ ì›€ì§ì„ ì¶”ì 
      document.addEventListener('mousemove', function(e) {
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
      });
    }

    function animateFakeCursor() {
      // ì²« ë²ˆì§¸ ìë™ ì• ë‹ˆë©”ì´ì…˜
      animateFakeCursorToButton(() => {
        sendMessage();
        isFirstAnimation = false; // ì²« ë²ˆì§¸ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í‘œì‹œ
      });
    }

    function animateFakeCursorToButton(callback) {
      const fakeCursor = document.getElementById('fakeCursor');
      const sendButton = document.getElementById('sendButton');

      // ì „ì†¡ ë²„íŠ¼ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
      const buttonRect = sendButton.getBoundingClientRect();
      const cursorSize = 48; // ì»¤ì„œ í¬ê¸° (48px)
      const offset = cursorSize / 2; // ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ ì˜¤í”„ì…‹

      // ì‹¤ì œ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¶€í„° ì‹œì‘
      const startX = lastMouseX - offset;
      const startY = lastMouseY - offset;
      const endX = buttonRect.left + buttonRect.width / 2 - offset;
      const endY = buttonRect.top + buttonRect.height / 2 - offset;

      // ê°€ì§œ ì»¤ì„œ ì‹œì‘ ìœ„ì¹˜ ì„¤ì • (ì‹¤ì œ ë§ˆìš°ìŠ¤ ìœ„ì¹˜)
      fakeCursor.style.left = startX + 'px';
      fakeCursor.style.top = startY + 'px';
      fakeCursor.classList.add('show');

      // ì „ì†¡ ë²„íŠ¼ìœ¼ë¡œ ì´ë™
      setTimeout(() => {
        fakeCursor.style.left = endX + 'px';
        fakeCursor.style.top = endY + 'px';

        // ë²„íŠ¼ì— ë„ë‹¬í•˜ë©´ í¬ì¸íŒ… í•¸ë“œë¡œ ë³€ê²½
        setTimeout(() => {
          fakeCursor.classList.remove('normal');
          fakeCursor.classList.add('pointing');
          sendButton.classList.add('cursor-hover');

          // í´ë¦­ íš¨ê³¼
          setTimeout(() => {
            sendButton.classList.add('cursor-click');

            // ì½œë°± ì‹¤í–‰ (ë©”ì‹œì§€ ì „ì†¡)
            setTimeout(() => {
              if (callback) callback();

              // ê°€ì§œ ì»¤ì„œ ìˆ¨ê¸°ê¸° ë° ì´ˆê¸°í™”
              fakeCursor.classList.remove('show', 'pointing');
              fakeCursor.classList.add('normal');
              sendButton.classList.remove('cursor-hover', 'cursor-click');
            }, 150);

          }, 200);
        }, 500);
      }, 100);
    }

    function startFirstConversation() {
      const chatInput = document.getElementById('chatInput');
      const sendButton = document.getElementById('sendButton');

      // ëŒ€í™”í˜• ëª¨ë“œì—ì„œ ì‚¬ìš©ìê°€ ì²˜ìŒ ìŠ¤í¬ë¡¤í•˜ë©´ ì²« ë²ˆì§¸ ì§ˆë¬¸ í‘œì‹œ
      hasUserScrolledInChatMode = true;

      // ì²« ë²ˆì§¸ ì§ˆë¬¸ ë°”ë¡œ ì…ë ¥
      chatInput.value = questions[0];
      chatInput.disabled = false;
      sendButton.disabled = false;

      // ê°€ì§œ ì»¤ì„œ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      setTimeout(() => {
        animateFakeCursor();
      }, 250);
    }

    function typeMessage(message, input, callback) {
      if (isTyping) return;

      isTyping = true;
      input.value = '';
      let i = 0;

      const typing = setInterval(() => {
        input.value += message[i];
        i++;

        if (i >= message.length) {
          clearInterval(typing);
          isTyping = false;
          if (callback) callback();
        }
      }, 50);
    }

    function showEndMessage() {
      const endMessage = document.getElementById('end-message');
      if (endMessage) {
        endMessage.style.display = 'block';
        setTimeout(() => {
          endMessage.classList.add('show');
        }, 100);
      }
    }

    function sendMessage() {
      const chatInput = document.getElementById('chatInput');
      const sendButton = document.getElementById('sendButton');

      if (isTyping) return;

      const sectionIds = ['intro', 'skills-backend', 'experience', 'projects', 'certifications'];
      const currentSectionId = sectionIds[currentSectionIndex];

      if (currentSectionId) {
        const targetElement = document.getElementById(currentSectionId);

        if (targetElement) {
          // ìŠ¤í¬ë¡¤ ì…ë ¥ ë¬´ì‹œ ì‹œì‘
          disableScrollInput();

          // ëª©ì°¨ í´ë¦­ê³¼ ë™ì¼í•œ íš¨ê³¼: í´ë¦­í•œ ì„¹ì…˜ê¹Œì§€ì˜ ëª¨ë“  ì„¹ì…˜ í‘œì‹œ
          showSectionsUpTo(currentSectionId);

          // ì²« ë²ˆì§¸ ì§ˆë¬¸(ìê¸°ì†Œê°œ)ì´ ì•„ë‹Œ ê²½ìš°ë§Œ ìŠ¤í¬ë¡¤
          if (currentSectionId !== 'intro') {
            // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ (ëª¨ë°”ì¼ ìµœì í™”)
            setTimeout(() => {
              const isMobile = window.innerWidth <= 480;
              const isFirstSection = currentSectionId === 'intro';

              if (isMobile) {
                if (isFirstSection) {
                  // ì²« ë²ˆì§¸ ì„¹ì…˜ì€ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
                  document.querySelector('.chat-messages').scrollTo({
                    top: 0,
                    behavior: 'smooth'
                  });
                } else {
                  // ë‹¤ë¥¸ ì„¹ì…˜ë“¤ì€ ì§ˆë¬¸ ë¶€ë¶„ì´ ë³´ì´ë„ë¡ ì¡°ì •
                  const chatMessages = document.querySelector('.chat-messages');
                  const targetRect = targetElement.getBoundingClientRect();
                  const containerRect = chatMessages.getBoundingClientRect();
                  const headerHeight = document.querySelector('.chat-header').offsetHeight;

                  // í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì—ì„œ íƒ€ê²Ÿê¹Œì§€ì˜ ê±°ë¦¬ ê³„ì‚°
                  const scrollTop = chatMessages.scrollTop;
                  const targetTop = targetElement.offsetTop;

                  // í—¤ë” ë†’ì´ë¥¼ ê³ ë ¤í•œ ìŠ¤í¬ë¡¤ ìœ„ì¹˜
                  const finalScrollTop = targetTop - headerHeight - 20; // 20px ì—¬ë°±

                  chatMessages.scrollTo({
                    top: Math.max(0, finalScrollTop),
                    behavior: 'smooth'
                  });
                }
              } else {
                targetElement.scrollIntoView({
                  behavior: 'smooth',
                  block: 'start'
                });
              }

              // ìŠ¤í¬ë¡¤ ì™„ë£Œ í›„ ì…ë ¥ ë‹¤ì‹œ í™œì„±í™”
              setTimeout(() => {
                enableScrollInput();
              }, 1000); // ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ ê³ ë ¤
            }, 100);
          } else {
            // ì²« ë²ˆì§¸ ì„¹ì…˜ì¸ ê²½ìš° ë°”ë¡œ ì…ë ¥ í™œì„±í™”
            enableScrollInput();
          }

          // ì…ë ¥ì°½ ë¹„ìš°ê¸°
          chatInput.value = '';

          // ë„¤ë¹„ê²Œì´ì…˜ í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸ (ë¨¼ì €)
          updateActiveNavItem(currentSectionId);

          // ë‹¤ìŒ ì§ˆë¬¸ ì¤€ë¹„
          prepareNextQuestion();
        }
      }
    }

    let scrollInputDisabled = false;
    let hasUserScrolledInChatMode = false;
    let chatModeState = {
      visibleSections: [],
      currentSectionIndex: 0,
      hasUserScrolled: false
    };

    function disableScrollInput() {
      scrollInputDisabled = true;
    }

    function enableScrollInput() {
      scrollInputDisabled = false;
    }

    function showCurrentSectionInSpace() {
      const sectionIds = ['intro', 'skills-backend', 'experience', 'projects', 'certifications'];
      const currentSectionId = sectionIds[currentSectionIndex];
      const prevSectionId = sectionIds[currentSectionIndex - 1];

      // ì´ì „ ì„¹ì…˜ì˜ ì—¬ë°± ê³µê°„ ì°¾ê¸°
      const nextQuestionSpace = document.getElementById('next-' + prevSectionId);

      if (nextQuestionSpace && currentSectionId) {
        // í˜„ì¬ ì„¹ì…˜ì˜ ë‚´ìš©ì„ ê°€ì ¸ì™€ì„œ ì´ì „ ì„¹ì…˜ì˜ ì—¬ë°±ì— ë„£ê¸°
        const currentSection = document.getElementById(currentSectionId);
        if (currentSection) {
          nextQuestionSpace.innerHTML = currentSection.innerHTML;
          nextQuestionSpace.style.display = 'block';

          // ìƒˆë¡œ ì¶”ê°€ëœ ì„¹ì…˜ì— ì•„ë°”íƒ€ ì¶”ê°€
          addAvatarsToSection(nextQuestionSpace);
        }
      }
    }

    function addAvatarsToSection(sectionElement) {
      // ë‹µë³€ ë©”ì‹œì§€ì— ì•„ë°”íƒ€ ì»¨í…Œì´ë„ˆ ì¶”ê°€
      sectionElement.querySelectorAll('.answer').forEach((answer) => {
        if (!answer.querySelector('.avatar-container')) {
          const avatarContainer = document.createElement('div');
          avatarContainer.className = 'avatar-container';

          const avatar = document.createElement('div');
          avatar.className = 'avatar profile-avatar clickable-avatar';
          avatar.addEventListener('click', function() {
            document.getElementById('profileModal').style.display = 'block';
          });
          avatarContainer.appendChild(avatar);

          answer.insertBefore(avatarContainer, answer.querySelector('.message'));
        }
      });

      // ì§ˆë¬¸ ë©”ì‹œì§€ì— ì•„ë°”íƒ€ ì¶”ê°€
      sectionElement.querySelectorAll('.question').forEach(question => {
        let avatarContainer = question.querySelector('.avatar-container');

        if (!avatarContainer) {
          avatarContainer = document.createElement('div');
          avatarContainer.className = 'avatar-container';

          const avatar = document.createElement('div');
          avatar.className = 'avatar user-avatar';
          // SVG ì œê±°: ì´ì œ CSS ë°°ê²½ ì´ë¯¸ì§€(ì±—ë´‡.jpg) ì‚¬ìš©

          avatarContainer.appendChild(avatar);
          question.appendChild(avatarContainer);
        }
      });
    }


    function showCurrentSection() {
      const sections = document.querySelectorAll('.chat-section');
      if (sections[currentSectionIndex]) {
        const section = sections[currentSectionIndex];
        section.style.display = 'block';

        // ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ìˆœì°¨ì ìœ¼ë¡œ ë‚˜íƒ€ë‚´ê¸°
        const question = section.querySelector('.question');
        const answers = section.querySelectorAll('.answer');

        if (question) {
          // ìˆœì°¨ í‘œì‹œìš© í´ë˜ìŠ¤ ì¶”ê°€
          question.classList.add('sequential');
          answers.forEach(answer => answer.classList.add('sequential'));

          // ì§ˆë¬¸ ë¨¼ì € í‘œì‹œ
          question.classList.add('show');

          // 0.5ì´ˆ í›„ ë‹µë³€ë“¤ ìˆœì°¨ì ìœ¼ë¡œ í‘œì‹œ
          setTimeout(() => {
            answers.forEach((answer, index) => {
              setTimeout(() => {
                answer.classList.add('show');
              }, index * 200); // ê° ë‹µë³€ë§ˆë‹¤ 0.2ì´ˆì”© ë”œë ˆì´
            });
          }, 500); // ì§ˆë¬¸ í›„ 0.5ì´ˆ ë”œë ˆì´
        }
      }
    }


    function showStartMessage() {
      const startMessage = document.getElementById('start-message');
      if (startMessage) {
        startMessage.style.display = 'block';
        setTimeout(() => {
          startMessage.classList.add('show');
        }, 100);
      }
    }


    function prepareNextQuestion() {
      const chatInput = document.getElementById('chatInput');
      const sendButton = document.getElementById('sendButton');

      currentSectionIndex++;

      if (currentSectionIndex < questions.length) {
        // ë‹¤ìŒ ì§ˆë¬¸ì´ í™”ë©´ì— ë³´ì´ëŠ”ì§€ í™•ì¸ (ì›ë˜ëŒ€ë¡œ ë³µêµ¬)
        setTimeout(() => {
          checkAndAutoFillQuestion();
        }, 1100);
      } else {
        // ëª¨ë“  ëŒ€í™” ì™„ë£Œ - ì¢…ë£Œ ë©”ì‹œì§€ í‘œì‹œ ë° ì…ë ¥ì°½ ë¹„í™œì„±í™”
        showEndMessage();
        chatInput.value = '';
        chatInput.placeholder = '';
        chatInput.disabled = true;
        sendButton.disabled = true;
      }
    }

    function checkAndAutoFillQuestion() {
      const chatInput = document.getElementById('chatInput');
      const sendButton = document.getElementById('sendButton');
      const chatMessages = document.getElementById('chatMessages');

      if (currentSectionIndex < questions.length) {
        const sections = document.querySelectorAll('.chat-section');
        const nextSection = sections[currentSectionIndex];

        if (nextSection) {
          const rect = nextSection.getBoundingClientRect();
          const containerRect = chatMessages.getBoundingClientRect();

          // ë‹¤ìŒ ì„¹ì…˜ì´ í™”ë©´ì— ë³´ì´ë©´ (ë˜ëŠ” ê³§ ë³´ì¼ ìœ„ì¹˜ì— ìˆìœ¼ë©´)
          if (rect.top <= containerRect.bottom + 200) {
            // ëŒ€í™”í˜• ëª¨ë“œì—ì„œ ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ì§ˆë¬¸ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            if (!hasUserScrolledInChatMode) {
              chatInput.disabled = true;
              sendButton.disabled = true;
              return;
            }

            // ë°”ë¡œ ì§ˆë¬¸ ì…ë ¥
            chatInput.value = questions[currentSectionIndex];
            chatInput.disabled = false;
            sendButton.disabled = false;
          } else {
            // ìŠ¤í¬ë¡¤í•´ì•¼ ë³´ì´ëŠ” ìœ„ì¹˜ë¼ë©´ ìŠ¤í¬ë¡¤ ê°ì§€ ëŒ€ê¸°
            chatInput.disabled = true;
            sendButton.disabled = true;
          }
        }
      }
    }

    function initializeChatInput() {
      const chatInput = document.getElementById('chatInput');
      const sendButton = document.getElementById('sendButton');

      if (!chatInput || !sendButton) return;

      // ì´ˆê¸° ìƒíƒœ
      chatInput.disabled = true;
      sendButton.disabled = true;

      // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      sendButton.addEventListener('click', function() {
        if (!isTyping && !chatInput.disabled) {
          if (isFirstAnimation) {
            // ì²« ë²ˆì§¸ëŠ” ì• ë‹ˆë©”ì´ì…˜ê³¼ í•¨ê»˜
            animateFakeCursorToButton(() => {
              sendMessage();
              isFirstAnimation = false;
            });
          } else {
            // ì´í›„ì—ëŠ” ë°”ë¡œ ì „ì†¡
            sendMessage();
          }
        }
      });

      // ì—”í„°í‚¤ ì´ë²¤íŠ¸
      chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !isTyping && !chatInput.disabled) {
          if (isFirstAnimation) {
            // ì²« ë²ˆì§¸ëŠ” ì• ë‹ˆë©”ì´ì…˜ê³¼ í•¨ê»˜
            animateFakeCursorToButton(() => {
              sendMessage();
              isFirstAnimation = false;
            });
          } else {
            // ì´í›„ì—ëŠ” ë°”ë¡œ ì „ì†¡
            sendMessage();
          }
        }
      });

      // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ - ë‹¤ìŒ ì„¹ì…˜ì´ í™”ë©´ì— ë‚˜íƒ€ë‚˜ë©´ ì§ˆë¬¸ ì…ë ¥ + ë§¨ ì•„ë˜ì—ì„œ ì•„ë˜ ìŠ¤í¬ë¡¤ ì‹œ ë‹¤ìŒ ëŒ€í™”
      const chatMessages = document.getElementById('chatMessages');
      let isAtBottom = false;

      function checkScrollPosition() {
        const scrollTop = chatMessages.scrollTop;
        const scrollHeight = chatMessages.scrollHeight;
        const clientHeight = chatMessages.clientHeight;

        // í˜„ì¬ í‘œì‹œëœ ì„¹ì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
        const sections = document.querySelectorAll('.chat-section');
        const currentSection = sections[currentSectionIndex];

        if (currentSection && currentSection.style.display === 'block') {
          // ì„¹ì…˜ì˜ ì‹¤ì œ ë‚´ìš© ì˜ì—­ ëê¹Œì§€ ìŠ¤í¬ë¡¤í–ˆëŠ”ì§€ í™•ì¸ (ì—¬ë°± ì‹œì‘ì )
          const sectionRect = currentSection.getBoundingClientRect();
          const containerRect = chatMessages.getBoundingClientRect();

          // ì„¹ì…˜ ë‚´ìš©ì´ í™”ë©´ ìƒë‹¨ ê·¼ì²˜ì— ìˆê³ , ì—¬ë°± ì˜ì—­ì— ì§„ì…í–ˆëŠ”ì§€ í™•ì¸
          const sectionTopInContainer = sectionRect.top - containerRect.top;
          const hasScrolledThroughContent = sectionTopInContainer <= -(sectionRect.height * 0.7); // ë‚´ìš©ì˜ 70% ì´ìƒ ìŠ¤í¬ë¡¤

          isAtBottom = hasScrolledThroughContent;
        } else {
          // ê¸°ë³¸ ë™ì‘: ìŠ¤í¬ë¡¤ì´ ì—†ê±°ë‚˜ ë§¨ ì•„ë˜ì— ìˆëŠ”ì§€ í™•ì¸
          isAtBottom = (scrollHeight <= clientHeight) || (scrollTop + clientHeight >= scrollHeight - 10);
        }
      }

      chatMessages.addEventListener('scroll', function() {
        // ìŠ¤í¬ë¡¤ ì…ë ¥ì´ ë¬´ì‹œë˜ë©´ ì´ë²¤íŠ¸ ì¤‘ë‹¨
        if (scrollInputDisabled) {
          return;
        }

        // ëŒ€í™”í˜• ëª¨ë“œì—ì„œ ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤í–ˆìŒì„ ê¸°ë¡
        if (document.body.classList.contains('chat-mode')) {
          hasUserScrolledInChatMode = true;
        }

        checkScrollPosition();

        // ì…ë ¥ì°½ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆê³  ì•„ì§ ì…ë ¥ëœ ì§ˆë¬¸ì´ ì—†ë‹¤ë©´
        if (chatInput.disabled && !chatInput.value && currentSectionIndex < questions.length) {
          // ëŒ€í™”í˜• ëª¨ë“œì—ì„œ ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ì§ˆë¬¸ í‘œì‹œí•˜ì§€ ì•ŠìŒ
          if (!hasUserScrolledInChatMode) {
            return;
          }

          const sections = document.querySelectorAll('.chat-section');
          const nextSection = sections[currentSectionIndex];

          // ë‹¤ìŒ ì„¹ì…˜ì´ í‘œì‹œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (ê±´ë„ˆë›´ ì§ˆë¬¸ ë¬´ì‹œ)
          if (nextSection && nextSection.style.display === 'block') {
            // ëª©ì°¨ë¡œ ì´ë¯¸ ë…¸ì¶œëœ ì„¹ì…˜ì¸ì§€ í™•ì¸
            const isAlreadyExposed = nextSection.querySelector('.question.show') || nextSection.querySelector('.answer.show');

            // ì´ë¯¸ ë…¸ì¶œëœ ì„¹ì…˜ì´ë©´ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¬´ì‹œ
            if (isAlreadyExposed) {
              return;
            }

            const rect = nextSection.getBoundingClientRect();
            const containerRect = chatMessages.getBoundingClientRect();

            // ë‹¤ìŒ ì„¹ì…˜ì´ í™”ë©´ì— ë‚˜íƒ€ë‚˜ë©´ ì§ˆë¬¸ ì…ë ¥
            if (rect.top <= containerRect.bottom - 100) {
              chatInput.value = questions[currentSectionIndex];
              chatInput.disabled = false;
              sendButton.disabled = false;
            }
          }
        }
      });

      // ì´ˆê¸° ìŠ¤í¬ë¡¤ ìœ„ì¹˜ í™•ì¸
      checkScrollPosition();

      // íœ  ì´ë²¤íŠ¸ - ë§¨ ì•„ë˜ì—ì„œ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤ 2ë²ˆ ì‹œ ë‹¤ìŒ ëŒ€í™” ì „ì†¡
      let scrollAttempts = 0;
      let scrollTimeout;

      // PCìš© ë§ˆìš°ìŠ¤ íœ  ì´ë²¤íŠ¸
      chatMessages.addEventListener('wheel', function(e) {
        handleScrollEvent(e.deltaY > 0, e);
      });

      // ëª¨ë°”ì¼ìš© í„°ì¹˜ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸
      let touchStartY = 0;
      let touchEndY = 0;

      chatMessages.addEventListener('touchstart', function(e) {
        touchStartY = e.changedTouches[0].screenY;
      });

      chatMessages.addEventListener('touchend', function(e) {
        touchEndY = e.changedTouches[0].screenY;

        // ì•„ë˜ë¡œ ìŠ¤ì™€ì´í”„ (ìœ„ì—ì„œ ì•„ë˜ë¡œ)
        const isDownSwipe = touchStartY > touchEndY + 50; // 50px ì´ìƒ ìŠ¤ì™€ì´í”„

        if (isDownSwipe) {
          handleScrollEvent(true, e);
        }
      });

      function handleScrollEvent(isDownward, event) {
        // ìŠ¤í¬ë¡¤ ì…ë ¥ì´ ë¬´ì‹œë˜ë©´ ì´ë²¤íŠ¸ ì¤‘ë‹¨
        if (scrollInputDisabled) {
          if (event.preventDefault) event.preventDefault();
          return;
        }

        // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì‹¤ì‹œê°„ í™•ì¸
        checkScrollPosition();

        // ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•˜ë ¤ê³  í•˜ê³ , ë§¨ ì•„ë˜ì— ìˆê±°ë‚˜ ìŠ¤í¬ë¡¤ì´ ì—†ê³ , ë‹¤ìŒ ì§ˆë¬¸ì´ ì¤€ë¹„ë˜ì–´ ìˆìœ¼ë©´
        if (isDownward && isAtBottom && !chatInput.disabled && chatInput.value && !isTyping) {
          if (event.preventDefault) event.preventDefault(); // ê¸°ë³¸ ìŠ¤í¬ë¡¤ ë°©ì§€

          scrollAttempts++;

          // ì´ì „ íƒ€ì´ë¨¸ ì œê±°
          if (scrollTimeout) {
            clearTimeout(scrollTimeout);
          }

          // 2ë²ˆ ì´ìƒ ìŠ¤í¬ë¡¤í•˜ë©´ ì „ì†¡ (ëª¨ë°”ì¼ì—ì„œëŠ” 1ë²ˆìœ¼ë¡œ ì¡°ì •)
          const requiredAttempts = ('ontouchstart' in window) ? 1 : 2;

          if (scrollAttempts >= requiredAttempts) {
            scrollAttempts = 0; // ì¹´ìš´í„° ë¦¬ì…‹

            // ë‹¤ìŒ ëŒ€í™” ì „ì†¡
            if (isFirstAnimation) {
              animateFakeCursorToButton(() => {
                sendMessage();
                isFirstAnimation = false;
              });
            } else {
              sendMessage();
            }
          } else {
            // 1ì´ˆ í›„ ì¹´ìš´í„° ë¦¬ì…‹
            scrollTimeout = setTimeout(() => {
              scrollAttempts = 0;
            }, 1000);
          }
        }
      }
    }

    function initializeProfileModal() {
      // í”„ë¡œí•„ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
      document.getElementById('closeProfile').addEventListener('click', function() {
        document.getElementById('profileModal').style.display = 'none';
      });

      // ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
      document.querySelector('.tg-modal-overlay').addEventListener('click', function() {
        document.getElementById('profileModal').style.display = 'none';
      });
    }


    function initializeSidebarNavigation() {
      // ì´ˆê¸° breadcrumb ì„¤ì • (ì²« ë²ˆì§¸ ì„¹ì…˜ì€ title í‘œì‹œ)
      updateBreadcrumb('intro');

      // PC ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­ ì´ë²¤íŠ¸
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('data-section');
          const targetElement = document.getElementById(targetId);

          if (targetElement) {
            // ìŠ¤í¬ë¡¤ ì…ë ¥ ë¬´ì‹œ ì‹œì‘
            disableScrollInput();

            // currentSectionIndexë¥¼ í´ë¦­í•œ ì„¹ì…˜ì— ë§ê²Œ ì—…ë°ì´íŠ¸
            const sectionIds = ['intro', 'skills-backend', 'experience', 'projects', 'certifications'];
            const targetIndex = sectionIds.indexOf(targetId);
            if (targetIndex !== -1) {
              currentSectionIndex = targetIndex;
            }

            // í´ë¦­í•œ ì„¹ì…˜ê¹Œì§€ì˜ ëª¨ë“  ì„¹ì…˜ í‘œì‹œ
            showSectionsUpTo(targetId);

            // ë§ˆì§€ë§‰ ì„¹ì…˜(ìê²©ì¦)ì„ í´ë¦­í•œ ê²½ìš° ì…ë ¥ì°½ ë¹„í™œì„±í™”
            if (targetId === 'certifications') {
              const chatInput = document.getElementById('chatInput');
              const sendButton = document.getElementById('sendButton');

              chatInput.value = '';
              chatInput.placeholder = '';
              chatInput.disabled = true;
              sendButton.disabled = true;
            }

            // í™œì„± ìƒíƒœ ë¨¼ì € ì—…ë°ì´íŠ¸ (ìŠ¤í¬ë¡¤ ì¤‘ ë³€ê²½ ë°©ì§€)
            updateActiveNavItem(targetId);

            // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ (ëª¨ë°”ì¼ ìµœì í™”)
            setTimeout(() => {
              const isMobile = window.innerWidth <= 480;
              const isFirstSection = targetId === 'intro';

              if (isMobile) {
                if (isFirstSection) {
                  // ì²« ë²ˆì§¸ ì„¹ì…˜ì€ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
                  document.querySelector('.chat-messages').scrollTo({
                    top: 0,
                    behavior: 'smooth'
                  });
                } else {
                  // ë‹¤ë¥¸ ì„¹ì…˜ë“¤ì€ ì§ˆë¬¸ ë¶€ë¶„ì´ ë³´ì´ë„ë¡ ì¡°ì •
                  const chatMessages = document.querySelector('.chat-messages');
                  const headerHeight = document.querySelector('.chat-header').offsetHeight;
                  const targetTop = targetElement.offsetTop;
                  const finalScrollTop = targetTop - headerHeight - 20; // 20px ì—¬ë°±

                  chatMessages.scrollTo({
                    top: Math.max(0, finalScrollTop),
                    behavior: 'smooth'
                  });
                }
              } else {
                targetElement.scrollIntoView({
                  behavior: 'smooth',
                  block: 'start'
                });
              }

              // ìŠ¤í¬ë¡¤ ì™„ë£Œ í›„ ì…ë ¥ ë‹¤ì‹œ í™œì„±í™”
              setTimeout(() => {
                enableScrollInput();
              }, 1000);
            }, 100);
          }
        });
      });

      // ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­ ì´ë²¤íŠ¸
      document.querySelectorAll('.mobile-nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('data-section');
          const targetElement = document.getElementById(targetId);

          if (targetElement) {
            // ìŠ¤í¬ë¡¤ ì…ë ¥ ë¬´ì‹œ ì‹œì‘
            disableScrollInput();

            // currentSectionIndexë¥¼ í´ë¦­í•œ ì„¹ì…˜ì— ë§ê²Œ ì—…ë°ì´íŠ¸
            const sectionIds = ['intro', 'skills-backend', 'experience', 'projects', 'certifications'];
            const targetIndex = sectionIds.indexOf(targetId);
            if (targetIndex !== -1) {
              currentSectionIndex = targetIndex;
            }

            // í´ë¦­í•œ ì„¹ì…˜ê¹Œì§€ì˜ ëª¨ë“  ì„¹ì…˜ í‘œì‹œ
            showSectionsUpTo(targetId);

            // ë§ˆì§€ë§‰ ì„¹ì…˜(ìê²©ì¦)ì„ í´ë¦­í•œ ê²½ìš° ì…ë ¥ì°½ ë¹„í™œì„±í™”
            if (targetId === 'certifications') {
              const chatInput = document.getElementById('chatInput');
              const sendButton = document.getElementById('sendButton');

              chatInput.value = '';
              chatInput.placeholder = '';
              chatInput.disabled = true;
              sendButton.disabled = true;
            }

            // í™œì„± ìƒíƒœ ë¨¼ì € ì—…ë°ì´íŠ¸ (ìŠ¤í¬ë¡¤ ì¤‘ ë³€ê²½ ë°©ì§€)
            updateActiveNavItem(targetId);

            // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ (ëª¨ë°”ì¼ ìµœì í™”)
            setTimeout(() => {
              const isMobile = window.innerWidth <= 480;
              const isFirstSection = targetId === 'intro';

              if (isMobile) {
                if (isFirstSection) {
                  // ì²« ë²ˆì§¸ ì„¹ì…˜ì€ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
                  document.querySelector('.chat-messages').scrollTo({
                    top: 0,
                    behavior: 'smooth'
                  });
                } else {
                  // ë‹¤ë¥¸ ì„¹ì…˜ë“¤ì€ ì§ˆë¬¸ ë¶€ë¶„ì´ ë³´ì´ë„ë¡ ì¡°ì •
                  const chatMessages = document.querySelector('.chat-messages');
                  const headerHeight = document.querySelector('.chat-header').offsetHeight;
                  const targetTop = targetElement.offsetTop;
                  const finalScrollTop = targetTop - headerHeight - 20; // 20px ì—¬ë°±

                  chatMessages.scrollTo({
                    top: Math.max(0, finalScrollTop),
                    behavior: 'smooth'
                  });
                }
              } else {
                targetElement.scrollIntoView({
                  behavior: 'smooth',
                  block: 'start'
                });
              }

              // ìŠ¤í¬ë¡¤ ì™„ë£Œ í›„ ì…ë ¥ ë‹¤ì‹œ í™œì„±í™”
              setTimeout(() => {
                enableScrollInput();
              }, 1000);
            }, 100);
          }
        });
      });

      // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ë¡œ í˜„ì¬ ì„¹ì…˜ ê°ì§€
      let ticking = false;
      document.querySelector('.chat-messages').addEventListener('scroll', function() {
        // ìŠ¤í¬ë¡¤ ì…ë ¥ì´ ë¬´ì‹œë˜ëŠ” ì¤‘ì´ë©´ ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸ë„ ì¤‘ë‹¨
        if (scrollInputDisabled) {
          return;
        }

        if (!ticking) {
          requestAnimationFrame(function() {
            updateActiveSection();
            ticking = false;
          });
          ticking = true;
        }
      });
    }

    function showSectionsUpTo(targetSectionId) {
      const chatMessages = document.getElementById('chatMessages');
      const sections = document.querySelectorAll('.chat-section');
      const sectionIds = ['intro', 'skills-backend', 'experience', 'projects', 'certifications'];

      // íƒ€ê²Ÿ ì„¹ì…˜ì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
      const targetIndex = sectionIds.indexOf(targetSectionId);

      if (targetIndex !== -1) {
        // ì—¬ë°± ì¶•ì†Œ ì²˜ë¦¬
        let hasHeightChange = false;

        // íƒ€ê²Ÿ ì„¹ì…˜ê¹Œì§€ì˜ ëª¨ë“  ì„¹ì…˜ í‘œì‹œ
        sections.forEach((section, index) => {
          if (index <= targetIndex) {
            section.style.display = 'block';

            // ëª©ì°¨ë¡œ ë°”ë¡œ í‘œì‹œë˜ëŠ” ì„¹ì…˜ë“¤ì— show í´ë˜ìŠ¤ ì¶”ê°€ (ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë°©ì§€ìš©)
            const questions = section.querySelectorAll('.question');
            const answers = section.querySelectorAll('.answer');
            questions.forEach(q => q.classList.add('show'));
            answers.forEach(a => a.classList.add('show'));

            // íƒ€ê²Ÿ ì„¹ì…˜ ì´ì „ì˜ ëª¨ë“  ì„¹ì…˜ì„ ì½ê¸° ì™„ë£Œë¡œ í‘œì‹œ
            if (index < targetIndex && !section.classList.contains('read-completed')) {
              section.classList.add('read-completed');
              hasHeightChange = true;
            }
          }
        });

        // ìê²©ì¦ ì„¹ì…˜ì´ í‘œì‹œë˜ë©´ ë°”ë¡œ ì¢…ë£Œ ë©”ì‹œì§€ í‘œì‹œ
        if (targetSectionId === 'certifications') {
          showEndMessage();
        }

        // currentSectionIndexëŠ” ë‹¤ìŒì— í‘œì‹œë  ì§ˆë¬¸ì„ ìœ„í•´ targetIndexë¡œ ì„¤ì •í•˜ë˜,
        // ì•„ì§ í‘œì‹œë˜ì§€ ì•Šì€ ë‹¤ìŒ ì„¹ì…˜ì´ ìˆë‹¤ë©´ ê³„ì† ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ í•¨
        // ëª©ì°¨ë¡œ ê±´ë„ˆë›´ ê²½ìš°ì—ë„ ìˆœì°¨ì  ì§„í–‰ì´ ê°€ëŠ¥í•˜ë„ë¡ í•¨

        // ì—¬ë°± ì¶•ì†Œ í›„ ì…ë ¥ì°½ ìƒíƒœ ì—…ë°ì´íŠ¸
        setTimeout(() => {
          updateInputForSection();
        }, hasHeightChange ? 850 : 100); // ì—¬ë°± ë³€í™”ê°€ ìˆìœ¼ë©´ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„, ì—†ìœ¼ë©´ ì¦‰ì‹œ
      }
    }

    function updateInputForSection() {
      const chatInput = document.getElementById('chatInput');
      const sendButton = document.getElementById('sendButton');
      const sections = document.querySelectorAll('.chat-section');

      // í‘œì‹œë˜ì§€ ì•Šì€ ë‹¤ìŒ ì„¹ì…˜ ì°¾ê¸°
      let nextHiddenIndex = -1;
      sections.forEach((section, index) => {
        if (section.style.display === 'none' && nextHiddenIndex === -1) {
          nextHiddenIndex = index;
        }
      });

      if (nextHiddenIndex !== -1 && nextHiddenIndex < questions.length) {
        // ë‹¤ìŒ ìˆ¨ê²¨ì§„ ì„¹ì…˜ì´ ìˆìŒ
        chatInput.value = questions[nextHiddenIndex];
        chatInput.disabled = false;
        sendButton.disabled = false;
        // currentSectionIndexë¥¼ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì—…ë°ì´íŠ¸
        currentSectionIndex = nextHiddenIndex;
      } else {
        // ëª¨ë“  ì„¹ì…˜ì´ í‘œì‹œë¨
        chatInput.value = '';
        chatInput.placeholder = '';
        chatInput.disabled = true;
        sendButton.disabled = true;
      }
    }

    function updateActiveNavItem(sectionId) {
      // PC ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      const activeItem = document.querySelector('.nav-item[data-section="' + sectionId + '"]');
      if (activeItem) {
        activeItem.classList.add('active');
      }

      // ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.mobile-nav-item').forEach(item => {
        item.classList.remove('active');
      });
      const activeMobileItem = document.querySelector('.mobile-nav-item[data-section="' + sectionId + '"]');
      if (activeMobileItem) {
        activeMobileItem.classList.add('active');

        // í™œì„± í•­ëª©ì´ í™”ë©´ì— ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
        activeMobileItem.scrollIntoView({
          behavior: 'smooth',
          block: 'nearest',
          inline: 'center'
        });
      }

      // breadcrumb ì—…ë°ì´íŠ¸
      updateBreadcrumb(sectionId);
    }

    function updateBreadcrumb(sectionId) {
      const headerTitle = document.getElementById('headerTitle');
      const breadcrumb = document.getElementById('breadcrumb');
      const currentSection = document.getElementById('currentSection');
      const chatHeader = document.querySelector('.chat-header');

      // ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
      if (!headerTitle || !breadcrumb || !currentSection || !chatHeader) {
        return;
      }

      if (sectionId && sectionNames[sectionId]) {
        // ì²« ë²ˆì§¸ ì„¹ì…˜ì´ ì•„ë‹ˆë©´ ì„¹ì…˜ ì´ë¦„ë§Œ í‘œì‹œ
        if (sectionId !== 'intro') {
          headerTitle.style.display = 'none';
          breadcrumb.style.display = 'flex';
          currentSection.textContent = sectionNames[sectionId];
          chatHeader.classList.add('compact'); // í—¤ë” í¬ê¸° ì¶•ì†Œ
        } else {
          // ì²« ë²ˆì§¸ ì„¹ì…˜ì´ë©´ ì›ë˜ íƒ€ì´í‹€ í‘œì‹œ
          headerTitle.style.display = 'block';
          breadcrumb.style.display = 'none';
          chatHeader.classList.remove('compact'); // í—¤ë” í¬ê¸° ë³µì›
        }
      }
    }

    function updateActiveSection() {
      const sections = document.querySelectorAll('.chat-section');
      const scrollContainer = document.querySelector('.chat-messages');
      const containerHeight = scrollContainer.clientHeight;

      let currentSection = null;

      sections.forEach(section => {
        // í‘œì‹œë˜ì§€ ì•Šì€ ì„¹ì…˜ì€ ê±´ë„ˆë›°ê¸°
        if (section.style.display === 'none') {
          return;
        }

        const rect = section.getBoundingClientRect();
        const containerRect = scrollContainer.getBoundingClientRect();
        const relativeTop = rect.top - containerRect.top;

        // ì„¹ì…˜ì´ í™”ë©´ ìƒë‹¨ 1/3 ì§€ì ì— ìˆìœ¼ë©´ í™œì„±í™” (í‘œì‹œëœ ì„¹ì…˜ë§Œ)
        if (relativeTop <= containerHeight / 3 && relativeTop >= -rect.height + containerHeight / 3) {
          currentSection = section.id;
        }
      });

      if (currentSection) {
        updateActiveNavItem(currentSection);
      }
    }

    function updateQuestionAvatars() {
      document.querySelectorAll('.question').forEach(question => {
        let avatarContainer = question.querySelector('.avatar-container');

        if (!avatarContainer) {
          avatarContainer = document.createElement('div');
          avatarContainer.className = 'avatar-container';

          const avatar = document.createElement('div');
          avatar.className = 'avatar user-avatar';
          // SVG ì œê±°: ì´ì œ CSS ë°°ê²½ ì´ë¯¸ì§€(ì±—ë´‡.jpg) ì‚¬ìš©

          avatarContainer.appendChild(avatar);
          question.appendChild(avatarContainer);
        }
      });
    }

    function initializeModeToggle() {
      const toggleBtn = document.getElementById('modeToggle');

      toggleBtn.addEventListener('click', function() {
        const body = document.body;
        const isPdfMode = body.classList.contains('pdf-mode');

        if (isPdfMode) {
          // PDF ëª¨ë“œì—ì„œ ì±„íŒ… ëª¨ë“œë¡œ ì „í™˜
          body.classList.remove('pdf-mode');
          body.classList.add('chat-mode');

          toggleBtn.classList.remove('pdf-mode-active');
          toggleBtn.classList.add('chat-mode-active');
          toggleBtn.title = 'PDF í˜•íƒœë¡œ ì „í™˜';

          // ì±„íŒ… ëª¨ë“œ ë³µì›
          restoreChatMode();
        } else {
          // ì±„íŒ… ëª¨ë“œì—ì„œ PDF ëª¨ë“œë¡œ ì „í™˜
          body.classList.remove('chat-mode');
          body.classList.add('pdf-mode');

          toggleBtn.classList.remove('chat-mode-active');
          toggleBtn.classList.add('pdf-mode-active');
          toggleBtn.title = 'ëŒ€í™”í˜•ìœ¼ë¡œ ì „í™˜';

          // PDF ëª¨ë“œ ì„¤ì •
          enterPdfMode();
        }
      });
    }

    function enterPdfMode() {
      // ëŒ€í™”í˜• ëª¨ë“œì˜ í˜„ì¬ ìƒíƒœ ì €ì¥
      chatModeState.visibleSections = [];
      document.querySelectorAll('.chat-section').forEach(section => {
        if (section.style.display !== 'none') {
          chatModeState.visibleSections.push(section.id);
        }
      });
      chatModeState.currentSectionIndex = currentSectionIndex;
      chatModeState.hasUserScrolled = hasUserScrolledInChatMode;

      // ëŒ€í™”í˜• ëª¨ë“œ ìŠ¤í¬ë¡¤ ì¶”ì  ë¦¬ì…‹
      hasUserScrolledInChatMode = false;

      // ëª¨ë“  ì„¹ì…˜ í‘œì‹œ
      const sections = document.querySelectorAll('.chat-section');
      sections.forEach(section => {
        section.style.display = 'block';

        // ëª¨ë“  ì§ˆë¬¸ê³¼ ë‹µë³€ì— show í´ë˜ìŠ¤ ì¶”ê°€
        const questions = section.querySelectorAll('.question');
        const answers = section.querySelectorAll('.answer');
        questions.forEach(q => q.classList.add('show'));
        answers.forEach(a => a.classList.add('show'));
      });


      // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function restoreChatMode() {
      // PDF ëª¨ë“œì—ì„œ ì¶”ê°€ëœ ëª¨ë“  show í´ë˜ìŠ¤ ì œê±°
      document.querySelectorAll('.question.show, .answer.show').forEach(element => {
        element.classList.remove('show');
      });

      // ì¢…ë£Œ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
      const endMessage = document.getElementById('end-message');
      if (endMessage) {
        endMessage.style.display = 'none';
        endMessage.classList.remove('show');
      }

      // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
      hideAllSections();

      // ì €ì¥ëœ ìƒíƒœì—ì„œ í‘œì‹œë˜ì—ˆë˜ ì„¹ì…˜ë“¤ë§Œ ë³µì›
      if (chatModeState.visibleSections.length > 0) {
        chatModeState.visibleSections.forEach(sectionId => {
          const section = document.getElementById(sectionId);
          if (section) {
            section.style.display = 'block';

            // í•´ë‹¹ ì„¹ì…˜ì˜ ì§ˆë¬¸ê³¼ ë‹µë³€ì— show í´ë˜ìŠ¤ ë‹¤ì‹œ ì¶”ê°€
            const questions = section.querySelectorAll('.question');
            const answers = section.querySelectorAll('.answer');
            questions.forEach(q => q.classList.add('show'));
            answers.forEach(a => a.classList.add('show'));
          }
        });
      }

      // ì €ì¥ëœ ì¸ë±ìŠ¤ì™€ ìŠ¤í¬ë¡¤ ìƒíƒœ ë³µì›
      currentSectionIndex = chatModeState.currentSectionIndex;
      hasUserScrolledInChatMode = chatModeState.hasUserScrolled;

      // í˜„ì¬ í™œì„± ì„¹ì…˜ ìœ ì§€
      const currentSection = document.querySelector('.nav-item.active')?.getAttribute('data-section') || 'intro';
      updateActiveNavItem(currentSection);
      updateBreadcrumb(currentSection);

      // ì…ë ¥ì°½ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateInputForSection();

      // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›
      const targetElement = document.getElementById(currentSection);
      if (targetElement) {
        setTimeout(() => {
          targetElement.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }, 100);
      }
    }

    function initializePdfDownload() {
      const downloadBtn = document.getElementById('pdfDownload');

      downloadBtn.addEventListener('click', function() {
        downloadPDF();
      });
    }

    function downloadPDF() {
      // í˜„ì¬ ëª¨ë“œ ì €ì¥
      const currentMode = document.body.classList.contains('pdf-mode');

      // PDF ëª¨ë“œë¡œ ì „í™˜ (ì´ë¯¸ PDF ëª¨ë“œê°€ ì•„ë‹Œ ê²½ìš°)
      if (!currentMode) {
        document.body.classList.remove('chat-mode');
        document.body.classList.add('pdf-mode');
        enterPdfMode();
      }

      // ì ì‹œ ëŒ€ê¸° í›„ PDF ìƒì„± (ë Œë”ë§ ì™„ë£Œë¥¼ ìœ„í•´)
      setTimeout(() => {
        // í˜ì´ì§€ íƒ€ì´í‹€ ì„¤ì •
        const originalTitle = document.title;
        document.title = 'Developer Portfolio - ê°•ì„±ìš±';

        // ë¸Œë¼ìš°ì €ì˜ ì¸ì‡„ ê¸°ëŠ¥ í˜¸ì¶œ
        window.print();

        // ì›ë˜ íƒ€ì´í‹€ ë³µì›
        document.title = originalTitle;

        // ì›ë˜ ëª¨ë“œë¡œ ë³µì› (PDF ëª¨ë“œê°€ ì•„ë‹ˆì—ˆë˜ ê²½ìš°)
        if (!currentMode) {
          setTimeout(() => {
            document.body.classList.remove('pdf-mode');
            document.body.classList.add('chat-mode');

            const toggleBtn = document.getElementById('modeToggle');
            toggleBtn.classList.remove('pdf-mode-active');
            toggleBtn.classList.add('chat-mode-active');
            toggleBtn.title = 'PDF í˜•íƒœë¡œ ì „í™˜';

            restoreChatMode();
          }, 1000);
        }
      }, 500);
    }

  </script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js?t={{ site.time | date: "%s" }}"></script>

  <script>
    // Chart.js ì°¨íŠ¸ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // ë°±ì—”ë“œ ì–¸ì–´ & í”„ë ˆì„ì›Œí¬ ì°¨íŠ¸
      const backendCtx = document.getElementById('backendChart');
      if (backendCtx) {
        const backendChart = new Chart(backendCtx, {
          type: 'doughnut',
          data: {
            labels: [
              'Node.js & TypeScript',
              'Nest.js',

            ],
            datasets: [{
              data: [50, 25, 15, 10],
              backgroundColor: [
                '#3498db',
                '#2ecc71',
                '#9b59b6',
                '#34495e'
              ],
              borderWidth: 0,
              hoverBorderWidth: 3,
              hoverBorderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: true,
                position: 'right',
                labels: {
                  boxWidth: 12,
                  padding: 15,
                  font: {
                    size: 12
                  },
                  generateLabels: function(chart) {
                    const data = chart.data;
                    return data.labels.map((label, index) => {
                      const value = data.datasets[0].data[index];
                      return {
                        text: `${label} (${value}%)`,
                        fillStyle: data.datasets[0].backgroundColor[index],
                        strokeStyle: data.datasets[0].backgroundColor[index],
                        lineWidth: 0,
                        index: index
                      };
                    });
                  }
                }
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: 'rgba(255, 255, 255, 0.1)',
                borderWidth: 1,
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + context.parsed + '%';
                  }
                }
              }
            },
            cutout: '60%',
            animation: {
              animateRotate: true,
              duration: 1500
            },
            onHover: (event, activeElements, chart) => {
              updateCenterText(chart, activeElements, 'backend');
            }
          }
        });

        // ì´ˆê¸° ì¤‘ì•™ í…ìŠ¤íŠ¸ ì„¤ì •
        setTimeout(() => {
          updateCenterText(backendChart, [], 'backend');
        }, 1600);
      }

      // ë°ì´í„°ë² ì´ìŠ¤ ì°¨íŠ¸
      const databaseCtx = document.getElementById('databaseChart');
      if (databaseCtx) {
        const databaseChart = new Chart(databaseCtx, {
          type: 'doughnut',
          data: {
            labels: [
              'MySQL',
              'Redis',
              'PostgreSQL'
            ],
            datasets: [{
              data: [45, 30, 25],
              backgroundColor: [
                '#e74c3c',
                '#f39c12',
                '#16a085'
              ],
              borderWidth: 0,
              hoverBorderWidth: 3,
              hoverBorderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: true,
                position: 'right',
                labels: {
                  boxWidth: 12,
                  padding: 15,
                  font: {
                    size: 12
                  },
                  generateLabels: function(chart) {
                    const data = chart.data;
                    return data.labels.map((label, index) => {
                      const value = data.datasets[0].data[index];
                      return {
                        text: `${label} (${value}%)`,
                        fillStyle: data.datasets[0].backgroundColor[index],
                        strokeStyle: data.datasets[0].backgroundColor[index],
                        lineWidth: 0,
                        index: index
                      };
                    });
                  }
                }
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: 'rgba(255, 255, 255, 0.1)',
                borderWidth: 1,
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + context.parsed + '%';
                  }
                }
              }
            },
            cutout: '60%',
            animation: {
              animateRotate: true,
              duration: 1500
            },
            onHover: (event, activeElements, chart) => {
              updateCenterText(chart, activeElements, 'database');
            }
          }
        });

        // ì´ˆê¸° ì¤‘ì•™ í…ìŠ¤íŠ¸ ì„¤ì •
        setTimeout(() => {
          updateCenterText(databaseChart, [], 'database');
        }, 1600);
      }

      // DevOps & ì¸í”„ë¼ ì°¨íŠ¸
      const devopsCtx = document.getElementById('devopsChart');
      if (devopsCtx) {
        const devopsChart = new Chart(devopsCtx, {
          type: 'doughnut',
          data: {
            labels: [
              'Naver Cloud Platform',
              'AWS',
              'Docker',
              'Kubernetes',
              'Nginx',
              'Git',
              'Linux'
            ],
            datasets: [{
              data: [25, 23, 20, 12, 10, 7, 3],
              backgroundColor: [
                '#ff9500',
                '#232f3e',
                '#0db7ed',
                '#326ce5',
                '#269539',
                '#f05032',
                '#fcc624'
              ],
              borderWidth: 0,
              hoverBorderWidth: 3,
              hoverBorderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: true,
                position: 'right',
                labels: {
                  boxWidth: 12,
                  padding: 15,
                  font: {
                    size: 12
                  },
                  generateLabels: function(chart) {
                    const data = chart.data;
                    return data.labels.map((label, index) => {
                      const value = data.datasets[0].data[index];
                      return {
                        text: `${label} (${value}%)`,
                        fillStyle: data.datasets[0].backgroundColor[index],
                        strokeStyle: data.datasets[0].backgroundColor[index],
                        lineWidth: 0,
                        index: index
                      };
                    });
                  }
                }
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: 'rgba(255, 255, 255, 0.1)',
                borderWidth: 1,
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + context.parsed + '%';
                  }
                }
              }
            },
            cutout: '60%',
            animation: {
              animateRotate: true,
              duration: 1500
            },
            onHover: (event, activeElements, chart) => {
              updateCenterText(chart, activeElements, 'devops');
            }
          }
        });

        // ì´ˆê¸° ì¤‘ì•™ í…ìŠ¤íŠ¸ ì„¤ì •
        setTimeout(() => {
          updateCenterText(devopsChart, [], 'devops');
        }, 1600);
      }
    });

    // ì°¨íŠ¸ ì¤‘ì•™ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateCenterText(chart, activeElements, chartType) {
      const canvasPosition = Chart.helpers.getRelativePosition(chart.chartArea, chart.canvas);
      const centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
      const centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;

      // ê¸°ì¡´ ì¤‘ì•™ í…ìŠ¤íŠ¸ ì œê±°
      const existingText = chart.canvas.parentNode.querySelector('.chart-center-text');
      if (existingText) {
        existingText.remove();
      }

      // ìƒˆ ì¤‘ì•™ í…ìŠ¤íŠ¸ ìš”ì†Œ ìƒì„±
      const centerTextDiv = document.createElement('div');
      centerTextDiv.className = 'chart-center-text';
      centerTextDiv.style.position = 'absolute';
      centerTextDiv.style.left = '50%';
      centerTextDiv.style.top = '50%';
      centerTextDiv.style.transform = 'translate(-50%, -50%)';
      centerTextDiv.style.textAlign = 'center';
      centerTextDiv.style.pointerEvents = 'none';
      centerTextDiv.style.zIndex = '10';

      let title = '';
      let percentage = '';
      let description = '';

      if (activeElements.length > 0) {
        // í˜¸ë²„ëœ í•­ëª©ì´ ìˆì„ ë•Œ
        const index = activeElements[0].index;
        const dataset = chart.data.datasets[0];
        title = chart.data.labels[index];
        percentage = dataset.data[index] + '%';

        // ê°„ë‹¨í•œ ì„¤ëª… ì¶”ê°€
        if (chartType === 'backend') {
          const descriptions = {
            'Node.js & TypeScript': 'ì£¼ë ¥ ê°œë°œ ì–¸ì–´',
            'Nest.js': 'ì—”í„°í”„ë¼ì´ì¦ˆ í”„ë ˆì„ì›Œí¬',
          };
          description = descriptions[title] || '';
        } else if (chartType === 'database') {
          const descriptions = {
            'MySQL': 'ì£¼ ê´€ê³„í˜• DB',
            'Redis': 'ìºì‹± & ì„¸ì…˜',
            'PostgreSQL': 'ë³µì¡ ì¿¼ë¦¬ìš©'
          };
          description = descriptions[title] || '';
        } else if (chartType === 'devops') {
          const descriptions = {
            'Naver Cloud Platform': 'ìƒìš© ì„œë¹„ìŠ¤ ìš´ì˜',
            'AWS': 'ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ í™œìš©',
            'Docker': 'ì»¨í…Œì´ë„ˆí™”',
            'Kubernetes': 'ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜',
            'Nginx': 'ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ',
            'Git': 'ë²„ì „ ê´€ë¦¬',
            'Linux': 'ì„œë²„ ìš´ì˜'
          };
          description = descriptions[title] || '';
        }
      } else {
        // ê¸°ë³¸ ìƒíƒœ
        if (chartType === 'backend') {
          title = 'Backend';
          percentage = '100%';
          description = 'ê¸°ìˆ  ìŠ¤íƒ';
        } else if (chartType === 'database') {
          title = 'Database';
          percentage = '100%';
          description = 'ê¸°ìˆ  ìŠ¤íƒ';
        } else if (chartType === 'devops') {
          title = 'DevOps';
          percentage = '100%';
          description = 'ê¸°ìˆ  ìŠ¤íƒ';
        }
      }

      centerTextDiv.innerHTML = `
        <div style="font-size: 16px; font-weight: 600; color: #007AFF; margin-bottom: 4px;">${title}</div>
        <div style="font-size: 24px; font-weight: 700; color: #1a1a1a; margin-bottom: 2px;">${percentage}</div>
        <div style="font-size: 12px; color: #666;">${description}</div>
      `;

      // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
      chart.canvas.parentNode.style.position = 'relative';
      chart.canvas.parentNode.appendChild(centerTextDiv);
    }

    // ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ê¸°ëŠ¥
    function initializeImageGallery() {
      document.querySelectorAll('.project-card').forEach(card => {
        const gallery = card.querySelector('.image-gallery');
        const container = gallery.querySelector('.image-container');
        const images = container.querySelectorAll('img, .image-placeholder');
        const prevBtn = gallery.querySelector('.prev-btn');
        const nextBtn = gallery.querySelector('.next-btn');
        const navContainer = gallery.querySelector('.gallery-nav');
        const indicators = gallery.querySelector('.gallery-indicators');

        let currentIndex = 0;

        // ì´ë¯¸ì§€ ë¡œë“œ í›„ ê°¤ëŸ¬ë¦¬ ë†’ì´ ì¡°ì •
        function adjustGalleryHeight() {
          const currentImage = images[currentIndex];
          if (currentImage && currentImage.tagName === 'IMG') {
            const img = new Image();
            img.onload = function() {
              const aspectRatio = img.height / img.width;
              const containerWidth = gallery.offsetWidth;
              let idealHeight = containerWidth * aspectRatio;

              // ìµœì†Œ/ìµœëŒ€ ë†’ì´ ì œí•œ
              idealHeight = Math.max(200, Math.min(300, idealHeight));

              gallery.style.height = idealHeight + 'px';
              container.style.height = idealHeight + 'px';
            };
            img.src = currentImage.src;
          }
        }

        // ì´ë¯¸ì§€ê°€ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°ì—ë§Œ ë„¤ë¹„ê²Œì´ì…˜ í‘œì‹œ
        if (images.length > 1) {
          navContainer.style.display = 'flex';
          indicators.style.display = 'flex';

          // ì¸ë””ì¼€ì´í„° ìƒì„±
          indicators.innerHTML = '';
          images.forEach((_, index) => {
            const indicator = document.createElement('span');
            indicator.className = 'indicator';
            if (index === 0) indicator.classList.add('active');
            indicator.addEventListener('click', () => goToSlide(index));
            indicators.appendChild(indicator);
          });
        }

        function updateGallery() {
          container.style.transform = `translateX(-${currentIndex * 100}%)`;

          // ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
          indicators.querySelectorAll('.indicator').forEach((indicator, index) => {
            indicator.classList.toggle('active', index === currentIndex);
          });

          // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
          prevBtn.disabled = currentIndex === 0;
          nextBtn.disabled = currentIndex === images.length - 1;

          // í˜„ì¬ ì´ë¯¸ì§€ì— ë§ì¶° ë†’ì´ ì¡°ì •
          adjustGalleryHeight();
        }

        function goToSlide(index) {
          currentIndex = index;
          updateGallery();
        }

        function nextSlide() {
          if (currentIndex < images.length - 1) {
            currentIndex++;
            updateGallery();
          }
        }

        function prevSlide() {
          if (currentIndex > 0) {
            currentIndex--;
            updateGallery();
          }
        }

        // ë²„íŠ¼ ì´ë²¤íŠ¸
        prevBtn.addEventListener('click', prevSlide);
        nextBtn.addEventListener('click', nextSlide);

        // ì´ë¯¸ì§€ í´ë¦­ìœ¼ë¡œ í™•ëŒ€
        images.forEach((image, index) => {
          image.addEventListener('click', () => {
            if (image.tagName === 'IMG') {
              openImageModal(image.src, images, index);
            }
          });
        });

        // ì´ˆê¸° ìƒíƒœ ì„¤ì •
        updateGallery();
      });
    }

    // ì´ë¯¸ì§€ ëª¨ë‹¬ ê¸°ëŠ¥
    function openImageModal(imageSrc, images, currentIndex) {
      const modal = document.getElementById('imageModal');
      const modalImage = document.getElementById('modalImage');
      const modalPrev = document.getElementById('modalPrev');
      const modalNext = document.getElementById('modalNext');
      const modalClose = document.getElementById('modalClose');

      // ì‹¤ì œ ì´ë¯¸ì§€ë§Œ í•„í„°ë§
      const realImages = Array.from(images).filter(img => img.tagName === 'IMG');
      let modalIndex = realImages.findIndex(img => img.src === imageSrc);

      function updateModalImage() {
        modalImage.src = realImages[modalIndex].src;
        modalImage.alt = realImages[modalIndex].alt;

        modalPrev.disabled = modalIndex === 0;
        modalNext.disabled = modalIndex === realImages.length - 1;
      }

      function nextModalImage() {
        if (modalIndex < realImages.length - 1) {
          modalIndex++;
          updateModalImage();
        }
      }

      function prevModalImage() {
        if (modalIndex > 0) {
          modalIndex--;
          updateModalImage();
        }
      }

      function closeModal() {
        modal.classList.remove('show');
        document.body.style.overflow = '';
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      modalPrev.onclick = prevModalImage;
      modalNext.onclick = nextModalImage;
      modalClose.onclick = closeModal;

      // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
      function handleKeydown(e) {
        switch(e.key) {
          case 'Escape':
            closeModal();
            break;
          case 'ArrowLeft':
            prevModalImage();
            break;
          case 'ArrowRight':
            nextModalImage();
            break;
        }
      }

      // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
      modal.onclick = (e) => {
        if (e.target === modal) {
          closeModal();
        }
      };

      document.addEventListener('keydown', handleKeydown);

      // ëª¨ë‹¬ ì—´ê¸°
      updateModalImage();
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';

      // ëª¨ë‹¬ì´ ë‹«í ë•Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      modal.addEventListener('transitionend', function onTransitionEnd() {
        if (!modal.classList.contains('show')) {
          document.removeEventListener('keydown', handleKeydown);
          modal.removeEventListener('transitionend', onTransitionEnd);
        }
      });
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // ê¸°ì¡´ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤ì´ ì™„ë£Œëœ í›„ ê°¤ëŸ¬ë¦¬ ì´ˆê¸°í™”
      setTimeout(() => {
        initializeImageGallery();
      }, 100);
    });
  </script>
</body>

</html>
